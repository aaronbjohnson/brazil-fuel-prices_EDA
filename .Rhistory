filter(year == 2004 | year == 2019) %>%
arrange(year) %>%
mutate(state = fct_reorder(state, meanMarketValue, last))
# Make the altered version of change_df for the labels in the plot used below
mean_market_value <- change_df %>%
group_by(state) %>%
summarize(mean_market_value_per_state = mean(meanMarketValue)) %>%
ungroup()
change_df %>%
ggplot() +
geom_path(aes(meanMarketValue, state),
arrow = arrow(length = unit(1.5, "mm"), type = "closed")) +
geom_text(
aes(x = meanMarketValue,
y = state,
label = round(meanMarketValue, 2),
hjust = ifelse(year == "2004",
1.4,
-0.4)
),
size = 3,
family = "Bookman",
color = "gray25"
) +
# Add labels to the plot
labs(
x = "Mean Martek Value",
y = "State",
title = "Change in mean fuel price from 2004 to 2019",
subtitle = "Mean fuel price across similar fuel types: Diesel, Diesel s10, Etanol, and Gasoline",
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
coord_cartesian(xlim = c(1, 5)) +
geom_text(data = mean_market_value,
aes(y = state,
x = mean_market_value_per_state,
label = state),
vjust = 1.5,
family = "Bookman",
color = "gray25") +
# Remove axes and grids
theme(
axis.ticks = element_blank(),
axis.title = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank(),
# Reduce the font size of the subtitle
plot.subtitle = element_text(size = 9)
)
change_df %>%
ggplot() +
geom_path(aes(meanMarketValue, state),
arrow = arrow(length = unit(1.5, "mm"), type = "closed")) +
geom_text(
aes(x = meanMarketValue,
y = state,
label = round(meanMarketValue, 2),
hjust = ifelse(year == "2004",
1.4,
-0.4)
),
size = 3,
family = "Bookman",
color = "gray25"
) +
# Add labels to the plot
labs(
x = "Mean Martek Value",
y = "State",
title = "Change in mean fuel price from 2004 to 2019",
subtitle = "Mean fuel price across similar fuel types: Diesel, Diesel s10, Etanol, and Gasoline",
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
coord_cartesian(xlim = c(1, 5)) +
geom_text(data = mean_market_value,
aes(y = state,
x = mean_market_value_per_state,
label = state),
vjust = 1.5,
family = "Bookman",
color = "gray25") +
# Remove axes and grids
theme(
axis.ticks = element_blank(),
axis.title = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank(),
# Reduce the font size of the subtitle
plot.subtitle = element_text(size = 9)
)
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = region),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
windowsFonts(Bookman=windowsFont("TT Bookman Old Style"))
# Chunk 3
# Defining a custom theme function
theme_ilo <- function() {
theme_minimal() +
theme(
text = element_text(family = "Bookman", color = "gray25"),
plot.subtitle = element_text(size = 12),
plot.caption = element_text(color = "gray30"),
plot.background = element_rect(fill = "gray95"),
plot.margin = unit(c(5, 10, 5, 10), units = "mm")
)
}
# Chunk 4
library(tidyverse)
library(lubridate)
library(purrr)
library(broom)
raw_gas <- read.csv("2004-2019.tsv", sep = "\t")
# Chunk 5
glimpse(raw_gas)
# Chunk 6
clean_gas <- raw_gas %>%
select(-X) %>%
rename(start_date = DATA.INICIAL,
end_date = DATA.FINAL,
region = REGIÃƒO,
state = ESTADO,
product = PRODUTO,
num_stations_analyzed = NÃšMERO.DE.POSTOS.PESQUISADOS,
measurement_unit = UNIDADE.DE.MEDIDA,
mean_market_value = PREÃ.O.MÃ.DIO.REVENDA,
standard_deviation = DESVIO.PADRÃƒO.REVENDA,
min_price_observed = PREÃ.O.MÃ.NIMO.REVENDA,
max_price_observed = PREÃ.O.MÃ.XIMO.REVENDA,
mean_price_margin = MARGEM.MÃ.DIA.REVENDA,
coefficient_of_variation = COEF.DE.VARIAÃ.ÃƒO.REVENDA,
mean_dist_price = PREÃ.O.MÃ.DIO.DISTRIBUIÃ.ÃƒO,
dist_standard_dev = DESVIO.PADRÃƒO.DISTRIBUIÃ.ÃƒO,
dist_min_price = PREÃ.O.MÃ.NIMO.DISTRIBUIÃ.ÃƒO,
dist_max_price = PREÃ.O.MÃ.XIMO.DISTRIBUIÃ.ÃƒO,
dist_coef_var = COEF.DE.VARIAÃ.ÃƒO.DISTRIBUIÃ.ÃƒO,
month = MÃŠS,
year = ANO) %>%
mutate(start_date = ymd(start_date),
end_date = ymd(end_date),
mean_price_margin = as.numeric(as.character(mean_price_margin)),
mean_dist_price = as.numeric(as.character(mean_dist_price)),
dist_standard_dev = as.numeric(as.character(dist_standard_dev)),
dist_min_price = as.numeric(as.character(dist_min_price)),
dist_max_price = as.numeric(as.character(dist_max_price)),
dist_coef_var = as.numeric(as.character(dist_coef_var)),
state = str_to_title(state),
product = str_to_title(product),
region = str_to_title(region),
product = str_replace(product, "Etanol Hidratado", "Ethanol"),
product = str_replace(product, "Gasolina Comum", "Gasoline"),
product = str_replace(product, "Glp", "Propane"),
product = str_replace(product, "Gnv", "Compressed Natural Gas"),
product = str_replace(product, "Ã“Leo Diesel", "Diesel Oil"),
product = str_replace(product, "Ã“Leo Diesel S10", "Diesel Oil s10"),
region = str_replace(region, "Nordeste", "Northeast"),
region = str_replace(region, "Norte", "North"),
region = str_replace(region, "Sudeste", "Southeast"),
region = str_replace(region, "Sul", "South"),
region = str_replace(region, "Centro Oeste", "Midwest"))
# Chunk 7
glimpse(clean_gas)
# Chunk 8
liter_fuel <- clean_gas %>%
filter(product %in% c("Ethanol", "Gasoline", "Diesel Oil", "Diesel Oil S10"))
# Chunk 9
liter_fuel %>%
group_by(region, product) %>%
summarize(meanMarketValue = mean(mean_market_value)) %>%
ggplot(aes(region, meanMarketValue)) +
geom_bar(aes(fill = product), stat = "identity", position = "dodge") +
labs(
x = str_to_title("region"),
y = str_to_title("mean market value"),
title = str_to_title("Difference in fuel price by region"),
subtitle = str_to_title("Mean market value for each type of fuel"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
xlab(NULL) +
theme_ilo() +
coord_flip()
# Chunk 10
liter_fuel %>%
group_by(state, region, product) %>%
summarize(meanMarketValue = mean(mean_market_value)) %>%
ungroup() %>%
mutate(state = fct_reorder(state, meanMarketValue)) %>%
ggplot(aes(state, meanMarketValue)) +
geom_bar(aes(fill = region),stat = "identity") +
labs(
x = str_to_title("state"),
y = str_to_title("mean market value"),
title = str_to_title("Difference in mean market value for ethanol by state"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
scale_y_log10() +
facet_wrap(~ product) +
coord_flip() +
xlab(NULL) +
theme_ilo()
#theme(legend.position = "none")
# Chunk 11
liter_fuel %>%
group_by(region, year, product) %>%
summarize(meanMarketValue = mean(mean_market_value)) %>%
ggplot(aes(year, meanMarketValue)) +
geom_line(aes(color = product)) +
labs(
x = "Year",
y = "Mean Market Value",
title = str_to_title("Mean market value over time"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
scale_y_log10() +
facet_wrap(~ region) +
theme_ilo()
# Chunk 12
by_state <- liter_fuel %>%
group_by(year, state) %>%
summarize(meanMarketValue = mean(mean_market_value))
# Chunk 13
change_df <- by_state %>%
filter(year == 2004 | year == 2019) %>%
arrange(year) %>%
mutate(state = fct_reorder(state, meanMarketValue, last))
# Chunk 14
# Make the altered version of change_df for the labels in the plot used below
mean_market_value <- change_df %>%
group_by(state) %>%
summarize(mean_market_value_per_state = mean(meanMarketValue)) %>%
ungroup()
# Chunk 15
change_df %>%
ggplot() +
geom_path(aes(meanMarketValue, state),
arrow = arrow(length = unit(1.5, "mm"), type = "closed")) +
geom_text(
aes(x = meanMarketValue,
y = state,
label = round(meanMarketValue, 2),
hjust = ifelse(year == "2004",
1.4,
-0.4)
),
size = 3,
family = "Bookman",
color = "gray25"
) +
# Add labels to the plot
labs(
x = "Mean Martek Value",
y = "State",
title = "Change in mean fuel price from 2004 to 2019",
subtitle = "Mean fuel price across similar fuel types: Diesel, Diesel s10, Etanol, and Gasoline",
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
coord_cartesian(xlim = c(1, 5)) +
geom_text(data = mean_market_value,
aes(y = state,
x = mean_market_value_per_state,
label = state),
vjust = 1.5,
family = "Bookman",
color = "gray25") +
# Remove axes and grids
theme(
axis.ticks = element_blank(),
axis.title = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank(),
# Reduce the font size of the subtitle
plot.subtitle = element_text(size = 9)
)
# Chunk 16
state_coefficients <- by_state %>%
ungroup() %>%
nest(-state) %>%
mutate(models = map(data, ~ lm(meanMarketValue ~ year,.))) %>%
mutate(tidied = map(models, tidy)) %>%
unnest(tidied)
# Chunk 17
state_changes <- state_coefficients %>%
filter(term == "year") %>%
filter(p.adjust(p.value) < .05) %>%
select(state, estimate) %>%
rename(rate_of_change = estimate)
# Chunk 18
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = state),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = state),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
by_state_region <- liter_fuel %>%
group_by(year, state, region) %>%
summarize(meanMarketValue = mean(mean_market_value))
state_coefficients <- by_state_region %>%
ungroup() %>%
nest(-state) %>%
mutate(models = map(data, ~ lm(meanMarketValue ~ year,.))) %>%
mutate(tidied = map(models, tidy)) %>%
unnest(tidied)
state_changes <- state_coefficients %>%
filter(term == "year") %>%
filter(p.adjust(p.value) < .05) %>%
select(state, estimate) %>%
rename(rate_of_change = estimate)
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = state),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = region),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
by_state_region <- liter_fuel %>%
group_by(year, state, region) %>%
summarize(meanMarketValue = mean(mean_market_value))
by_state_region
state_coefficients
state_changes
state_coefficients <- by_state_region %>%
ungroup() %>%
nest(-state, -region) %>%
mutate(models = map(data, ~ lm(meanMarketValue ~ year,.))) %>%
mutate(tidied = map(models, tidy)) %>%
unnest(tidied)
state_coefficients
state_changes <- state_coefficients %>%
filter(term == "year") %>%
filter(p.adjust(p.value) < .05) %>%
select(state, estimate) %>%
rename(rate_of_change = estimate)
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = region),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
state_changes
state_coefficients
state_changes <- state_coefficients %>%
filter(term == "year") %>%
filter(p.adjust(p.value) < .05) %>%
select(state, region, estimate) %>%
rename(rate_of_change = estimate)
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = region),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL) +
theme(legend.position = "none")
state_changes %>%
mutate(state = fct_reorder(state, rate_of_change)) %>%
ggplot(aes(state, rate_of_change)) +
geom_bar(aes(fill = region),stat = "identity") +
coord_flip() +
labs(
x = "State",
y = "Rate of Change",
title = str_to_title("Yearly rate of increase in mean market value for all fuel"),
subtitle = str_to_title("Mean market value across similar fuel types: Diesel, Diesel s10, Ethanol, and Gasoline"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
theme_ilo() +
xlab(NULL)
#theme(legend.position = "none")
unique(raw_gas$PRODUTO)
unique(clean_gas$product)
clean_gas <- raw_gas %>%
select(-X) %>%
rename(start_date = DATA.INICIAL,
end_date = DATA.FINAL,
region = REGIÃƒO,
state = ESTADO,
product = PRODUTO,
num_stations_analyzed = NÃšMERO.DE.POSTOS.PESQUISADOS,
measurement_unit = UNIDADE.DE.MEDIDA,
mean_market_value = PREÃ.O.MÃ.DIO.REVENDA,
standard_deviation = DESVIO.PADRÃƒO.REVENDA,
min_price_observed = PREÃ.O.MÃ.NIMO.REVENDA,
max_price_observed = PREÃ.O.MÃ.XIMO.REVENDA,
mean_price_margin = MARGEM.MÃ.DIA.REVENDA,
coefficient_of_variation = COEF.DE.VARIAÃ.ÃƒO.REVENDA,
mean_dist_price = PREÃ.O.MÃ.DIO.DISTRIBUIÃ.ÃƒO,
dist_standard_dev = DESVIO.PADRÃƒO.DISTRIBUIÃ.ÃƒO,
dist_min_price = PREÃ.O.MÃ.NIMO.DISTRIBUIÃ.ÃƒO,
dist_max_price = PREÃ.O.MÃ.XIMO.DISTRIBUIÃ.ÃƒO,
dist_coef_var = COEF.DE.VARIAÃ.ÃƒO.DISTRIBUIÃ.ÃƒO,
month = MÃŠS,
year = ANO) %>%
mutate(start_date = ymd(start_date),
end_date = ymd(end_date),
mean_price_margin = as.numeric(as.character(mean_price_margin)),
mean_dist_price = as.numeric(as.character(mean_dist_price)),
dist_standard_dev = as.numeric(as.character(dist_standard_dev)),
dist_min_price = as.numeric(as.character(dist_min_price)),
dist_max_price = as.numeric(as.character(dist_max_price)),
dist_coef_var = as.numeric(as.character(dist_coef_var)),
state = str_to_title(state),
product = str_to_title(product),
region = str_to_title(region),
product = str_replace(product, "Etanol Hidratado", "Ethanol"),
product = str_replace(product, "Gasolina Comum", "Gasoline"),
product = str_replace(product, "Glp", "Propane"),
product = str_replace(product, "Gnv", "Compressed Natural Gas"),
product = str_replace(product, "Ã“Leo Diesel", "Diesel Oil"),
product = str_replace(product, "Ã“LEO DIESEL S10", "Diesel Oil s10"),
region = str_replace(region, "Nordeste", "Northeast"),
region = str_replace(region, "Norte", "North"),
region = str_replace(region, "Sudeste", "Southeast"),
region = str_replace(region, "Sul", "South"),
region = str_replace(region, "Centro Oeste", "Midwest"))
unique(clean_gas$product)
unique(liter_fuel$product)
liter_fuel %>%
group_by(region, product) %>%
summarize(meanMarketValue = mean(mean_market_value)) %>%
ggplot(aes(region, meanMarketValue)) +
geom_bar(aes(fill = product), stat = "identity", position = "dodge") +
labs(
x = str_to_title("region"),
y = str_to_title("mean market value"),
title = str_to_title("Difference in fuel price by region"),
subtitle = str_to_title("Mean market value for each type of fuel"),
caption = "Data source: https://www.kaggle.com/matheusfreitag/gas-prices-in-brazil"
) +
xlab(NULL) +
theme_ilo() +
coord_flip()
unique(clean_gas$product)
